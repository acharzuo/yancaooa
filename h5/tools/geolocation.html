<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="HandheldFriendly" content="true"/>
		<meta name="MobileOptimized" content="320"/>
		<title>地理位置收集</title>
		<script type="text/javascript" src="../js/common.js"></script>
		<script type="text/javascript" src="../js/baseShops.js" ></script>
		<script type="text/javascript" src="../js/mui.min.js" ></script>
		<script type="text/javascript">
var watchId;
var currPosition;
var currShop;
function geoInf( position ) {
	currPosition = position;
	var str = "";
	str += "地址："+position.addresses+"\n";//获取地址信息
	str += "坐标类型："+position.coordsType+"\n";
	var timeflag = position.timestamp;//获取到地理位置信息的时间戳；一个毫秒数；
	str += "时间戳："+timeflag+"\n";
	var codns = position.coords;//获取地理坐标信息；
	var lat = codns.latitude;//获取到当前位置的纬度；
	str += "纬度："+lat+"\n";
	var longt = codns.longitude;//获取到当前位置的经度
	str += "经度："+longt+"\n";
	var alt = codns.altitude;//获取到当前位置的海拔信息；
	str += "海拔："+alt+"\n";
	var accu = codns.accuracy;//地理坐标信息精确度信息；
	str += "精确度："+accu+"\n";
	var altAcc = codns.altitudeAccuracy;//获取海拔信息的精确度；
	str += "海拔精确度："+altAcc+"\n";
	var head = codns.heading;//获取设备的移动方向；
	str += "移动方向："+head+"\n";
	var sped = codns.speed;//获取设备的移动速度；
	str += "移动速度："+sped;
	console.log(JSON.stringify(position));
	outLine( str );
}
function getPos() {
	outSet( "获取位置信息:" );
	plus.geolocation.getCurrentPosition( geoInf, function ( e ) {
		outSet( "获取位置信息失败："+e.message );
	}, {geocode:false} );
}
function watchPos() {
	if ( watchId ) {
		return;
	}
	watchId = plus.geolocation.watchPosition( function ( p ) {
		outSet( "监听位置变化信息:" );
		geoInf( p );
	}, function ( e ) {
		outSet( "监听位置变化信息失败："+e.message );
	}, {geocode:false} );
}
function clearWatch() {
	if ( watchId ) {
		outSet( "停止监听位置变化信息" );
		plus.geolocation.clearWatch( watchId );
		watchId = null;
	}
}
// 通过定位模块获取位置信息
function getGeocode(){
	outSet( "获取定位位置信息:" );
	plus.geolocation.getCurrentPosition( geoInf, function ( e ) {
		outSet( "获取定位位置信息失败："+e.message );
	},{geocode:true,provider:'amap'});
}
		</script>
		<link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
		<link rel="stylesheet" href="../css/mui.min.css" type="text/css" charset="utf-8"/>
	</head>
	<body>
	<div id="homeDiv" class="mui-content own-content-padding">
		
			<form class="mui-input-group">
    <div class="mui-input-row">
        <label>许可证</label>
    <input type="text" class="mui-input-clear mui-numbox-input"  value="371621116239" id="licenseIdText" placeholder="请输入许可证号码">
    </div>
    <div class="mui-input-row">
        <label>名称</label>
        <input type="text" class="mui-input-password" readonly="true" id="licenseIdShow" placeholder="输入许可证号码自动显示">
    </div>
</form>
			<br/>
				<div class="button" onclick="searchId()">
				查询许可证
			</div>
			
			<div class="button" onclick="getGeocode()">
				获取定位
			</div>
			<div class="button" onclick="sendData()">
				核对并提交位置
			</div>
		</div>
		<div id="output">
可获取设备位置信息，包括经度、纬度、高度等信息。
		</div>
		
	</body>
	<!--<script type="text/javascript" src="../js/immersed.js" ></script>-->
	<script src="../js/ajax.js" charset="UTF-8"></script>
	<script>
		// 许可证变化事件处理
	

		
		var licenseIdText=document.getElementById("licenseIdText");
		var licenseIdShow = document.getElementById("licenseIdShow");
		licenseIdText.addEventListener('blur',function(){
			searchId();
		});
		// 查询许可证号码
		function searchId(){
			var id = licenseIdText.value;
			if(!id){
				mui.toast('请输入许可证后查询！');
				return;
			}
			var name = shops[id].name;
			currShop = shops[id];
			console.log(id,name);
			name =  name ? name : "请输入完整的许可证号码";
			licenseIdShow.value = name;
		}
		
		function sendData(){
			if(!currShop){
				mui.toast("请输入许可证号，选择店铺");
				return;
			} 
			if(!currPosition){
				mui.toast("请先获取定位");
				return;
			}
			ajax_post_shopInfo({
				shop:currShop,
				geolocation: currPosition
			})
		}
		
	</script>
</html>